<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="styles.css">
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
</head>

<body>
<div id="videos">
</div>

<div id="startPage">
    <div id="title">
        <h2>This is a demonstration for Moty & Rhodes (2019)</h2>
    </div>

    <div id="startButtons"> 
        <button id='study1' type="submit" onclick="startStudy(this)">Study 1</button>
        <button id='study2' type="submit" onclick="startStudy(this)">Study 2</button>
        <button id='study3' type="submit" onclick="startStudy(this)">Study 3</button>
    </div>
</div>

<button id='left' class='response' type="submit">Zarpies</button>
<button id='right' class='response' type="submit">Gorps</button>
<button id='invisible' class='invisible' type="submit">Nothing</button>

<script>
    var video_count = 0;
    var study = 0;
    
    var study1_videos = ["PiDi_1", "PiDi_2a", "PiDi_2b", "PiDi_2c", "PiDi_2d", "PiDi_2e",
    "PiDi_3_1a_gg", "PiDi_3_1b", "PiDi_3_1c", "PiDi_3_1d", "PiDi_3_2a_gg", "PiDi_3_2b", "PiDi_3_2d", "PiDi_3_2c",
    "PiDi_3_3a_gg", "PiDi_3_3b", "PiDi_3_3d", "PiDi_3_3d", "PiDi_3_4a_gg", "PiDi_3_4b", "PiDi_3_4c", "PiDi_3_4d",
    "PiDi_4", "PiDi_5a_1", "PiDi_5b_1", "PiDi_5c_1", "PiDi_5d_1", "PiDi_5e_1", "PiDi_5f"]

    var study1_buttons = ["none","response","response","invisible","invisible", "none",
    "none","none","invisible","invisible","none","none","invisible","invisible",
    "none","none","invisible","invisible","none","none","invisible","invisible",
    "invisible","invisible","invisible","invisible","invisible","invisible","end"
    ]

    var study2_videos = ["PiDi_1", "PiDi_2a", "PiDi_2b", "PiDi_2ca", "PiDi_2cb", "PiDi_2d", "PiDi_2e",
    "PiDi_3_1a_gg", "PiDi_3_1b", "PiDi_3_1c", "PiDi_3_1d", "PiDi_3_2a_gg", "PiDi_3_2b", "PiDi_3_2d", "PiDi_3_2c",
    "PiDi_3_3a_gg", "PiDi_3_3b", "PiDi_3_3d", "PiDi_3_3d", "PiDi_3_4a_gg", "PiDi_3_4b", "PiDi_3_4c", "PiDi_3_4d",
    "PiDi_4", "PiDi_5a_1", "PiDi_5b_1", "PiDi_5c_1", "PiDi_5d_1", "PiDi_5e_1", "PiDi_5f"]

    var study2_buttons = ["none","response","response","none","invisible","invisible", "none",
    "none","none","invisible","invisible","none","none","invisible","invisible",
    "none","none","invisible","invisible","none","none","invisible","invisible",
    "invisible","invisible","invisible","invisible","invisible","invisible","end"
    ]

    var study3_videos = ["video1", "video2", "video3", "video7", "video8", "video5", "video6", 
    "trial1a", "trial1b", "trial1c", "trial1d","trial2a", "trial2b", "trial2d", "trial2c",
    "trial3a", "trial3b", "trial3d", "trial3c","trial4a", "trial4b", "trial4c", "trial4d",
    "p1", "p2", "p3", "p4", "p5", "p6", "end"
    ]

    var study3_buttons = ["none","response","response","none","invisible","invisible", "none",
    "none","none","invisible","invisible","none","none","invisible","invisible",
    "none","none","invisible","invisible","none","none","invisible","invisible",
    "invisible","invisible","invisible","invisible","invisible","invisible","end"
    ]

    var videos = [study1_videos, study2_videos, study3_videos]
    var buttons = [study1_buttons, study2_buttons, study3_buttons]

    function playVideo(){
        if (video_count > 0) {
            document.getElementById(videos[study][video_count-1]).remove();
        }
        document.getElementById(videos[study][video_count]).style.visibility = "visible";
        document.getElementById(videos[study][video_count]).play();
        document.getElementById(videos[study][video_count]).onended = function () {
            displayButtons();
        }
    };

    function displayButtons(){
        if (buttons[study][video_count] == "response"){
            var bttns = document.querySelectorAll('.response')
            bttns.forEach((value) => {
                value.style.visibility = "visible";
                value.onclick = function(){
                    video_count++;
                    bttns.forEach((value) => {
                        value.style.visibility = "hidden";
                    })
                    playVideo();
                }
            })
        } else if (buttons[study][video_count] == "invisible"){
            document.querySelector('.invisible').style.visibility = "visible";
            document.querySelector('.invisible').onclick = function(){
                video_count++;
                document.querySelector('.invisible').style.visibility = "hidden";
                playVideo();
            }
        } else if (buttons[study][video_count] == "end") {
            location.reload();
        } else {
            video_count++;
            playVideo();
        }
        
    };

    function makeVideos(){
        videos[study].forEach((vids) => {
            vid = document.createElement("VIDEO");
            vid.id = vids;
            vid.src = "assets/" + vids + ".mp4";
            document.getElementById("videos").appendChild(vid);
        })
        playVideo();
    }

    function startStudy(bttn){
        study = bttn.id.match(/\d+/)[0] - 1;
        makeVideos();
        document.getElementById("startPage").remove();
    } 

</script>

</body>
</html>